(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-323ad9a4"],{"3e25":function(e,t,a){"use strict";a.r(t);a("cb29"),a("c740"),a("4160"),a("c975"),a("a15b"),a("d81d"),a("a434"),a("b0c0"),a("d3b7"),a("ac1f"),a("1276"),a("159b"),a("ddb0");var n=a("b85c"),r=(a("96cf"),a("1da1")),i=a("365c"),o=a("4ec3"),s={name:"tiandt",data:function(){return{x:"121.535",y:"29.873",eventinfoshow:!1,eventinfourl:"",dmap:{type:Object},myJSMap:null,orguid:"001",orgname:"",type:"",level1:"0",times:30,timeTimer:null,themeId:"",stime:"",etime:"",values:["20"],whereStr:"",videolist:[],videoIdList:new Array,zjData:{type:Object},etype:{type:Object},citys:[],eventtypeshow:!1,oldChooseData:[],drawer:!1,minzoom:1}},created:function(){this.TimeFormat(),this.GetEventTypeData()},mounted:function(){},methods:{initmap:function(e,t,a){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n.$nextTick((function(){var r=n;window.require(["jsmap"],(function(){r.dmap=JSMap.Map("map",{mapType:"电子地图(高端灰)"}),r.myJSMap=JSMap,r.orgname=t,r.type=a,r.minzoom="001"==e?1:(e.length,2),r.dmap.centerAndZoom(new JSMap.Point(121.535,29.873),0),r.dmap.setMaxZoom(9),r.dmap.setMinZoom(r.minzoom),r.dmap.setMapBGStyle("深蓝"),r.dmap.setBaseLayerOpacity(.4);r.orguid=e,"001"!=e&&(6==e.length?r.zjData=r.dmap.getLayerXSQ(r.orgname):r.zjData=r.dmap.getLayerJD(r.orgname),r.zjData.options.fill=!1,r.dmap.flyToLayer(r.zjData),r.dmap.setFenceLayer(r.zjData)),window.map=r.dmap,r.dmaplayer=JSMap,window.dmaplayer=r.dmaplayer,window.map=r.dmap,r.dmaplayer=JSMap,window.dmaplayer=r.dmaplayer,"001"!=r.orguid?r.dmap.on("zoomend",(function(){r.dmap.getZoom()<=7&&null!=r.dmap.getOverlayGroup("eventmarkerlist")&&r.removeMarkerVideo()})):r.dmap.on("zoomend",(function(){r.dmap.getZoom()<=1?(r.dmap.setBaseLayerOpacity(.4),null==r.dmap.getXYLayer("闪点图")&&r.scatterData(r.myJSMap)):(r.dmap.removeXYLayer("闪点图"),r.dmap.getZoom()<=7&&null!=r.dmap.getOverlayGroup("eventmarkerlist")&&r.removeMarkerVideo())})),r.SetMapZoom(JSMap)}))}));case 1:case"end":return r.stop()}}),r)})))()},setmarker:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function a(){var r,i,o,s,l,m;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:(r=t).dmap.removeOverlayGroup("eventmarkerlist"),r.videoIdList.forEach((function(e){r.dmap.removeOverlay(e)})),i=[],e.forEach((function(e){var t=r.myJSMap.Icon("http://10.68.129.154:8119/pages/NSquared/static/img/new.png",new r.myJSMap.Size(30,40)),a=new r.myJSMap.Marker(new JSMap.Point(e.x,e.y),{icon:t});a.on("click",(function(t){r.$parent.showNeventinfo(e.id)}));var n="<b>"+e.type+"["+e.date+"</b>]<br/>"+e.title;a.bindTooltip(n),i.push(a)})),(o=new r.myJSMap.OverlayGroup(i)).id="eventmarkerlist",r.dmap.addOverlayGroup(o),r.dmap.flyToLayer(i[0]),s=Object(n.a)(e);try{for(s.s();!(l=s.n()).done;)m=l.value,r.getvideolist(m)}catch(e){s.e(e)}finally{s.f()}case 11:case"end":return a.stop()}}),a)})))()},SetMapZoom:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t,i=a("4f46"),r.getQuery(),r.ClusterData(e,i),r.MarkerData(e,i),r.JZPolygon(e,r.orguid.length,r.orguid.length>3?r.orgname:"");case 6:case"end":return n.stop()}}),n)})))()},changeThemeEvent:function(e,t){var a=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(r=a).themeId=e,r.type=t,null!==r.dmap&&void 0!==r.dmap&&""!==r.dmap||r.initmap(r.orguid,r.orgname),r.removeMarkerVideo(),"001"!=r.orguid&&(6==r.orguid.length?r.zjData=r.dmap.getLayerXSQ(r.orgname):r.zjData=r.dmap.getLayerJD(r.orgname),r.zjData.options.fill=!1,r.dmap.flyToLayer(r.zjData),r.dmap.setFenceLayer(r.zjData)),r.SetMapZoom(r.myJSMap),"001"==r.orguid&&r.scatterData(),r.dmap.setZoom(r.minzoom);case 9:case"end":return n.stop()}}),n)})))()},changeLevelEvent:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:(n=t).level1="-1"==e?"0":e,null!==n.dmap&&void 0!==n.dmap&&""!==n.dmap||n.initmap(n.orguid,n.orgname),"001"!=n.orguid&&(6==n.orguid.length?n.zjData=n.dmap.getLayerXSQ(n.orgname):n.zjData=n.dmap.getLayerJD(n.orgname),n.zjData.options.fill=!1,n.dmap.flyToLayer(n.zjData),n.dmap.setFenceLayer(n.zjData)),n.removeMarkerVideo(),n.SetMapZoom(n.myJSMap),"001"==n.orguid&&n.scatterData(),n.dmap.setZoom(n.minzoom);case 8:case"end":return a.stop()}}),a)})))()},SetQXFont:function(){this.dmap.removeXYLayer("区县注记图");this.dmap.addXYLayer("区县注记图","jsmap_xianshi",{data:{field:"CENTERX,CENTERY,QX_NAME",x:"CENTERX",y:"CENTERY",value:"QX_NAME",size:50},symbol:{type:"Text",options:{size:15,font:"21px Arial",fillStyle:"#fff",shadowColor:"#333"},minZoom:1,maxZoom:4}})},SetZJFont:function(){this.dmap.removeXYLayer("镇街注记图");this.dmap.addXYLayer("镇街注记图","jsmap_jiedao",{data:{field:"CENTERX,CENTERY,JZ_NAME",x:"CENTERX",y:"CENTERY",value:"JZ_NAME",size:500},symbol:{type:"Text",options:{size:12,font:"18px Arial",fillStyle:"rgb(212, 130, 101)",shadowColor:"#fff"},minZoom:4,maxZoom:9}})},JZPolygon:function(e,t,a){this.dmap.removeXYLayer("基层网格乡镇街道");var n={data:{size:2e4,field:"CENTERX,CENTERY,QX_NAME,JZ_NAME",where:3==t?"":6==t?"(QX_NAME,eq,"+a+")":"(JZ_NAME,eq,"+a+")"},symbol:{type:"Polygon",options:{fillColor:"randomColor",color:"#ffffff",weight:1,opacity:.4},minZoom:2,maxZoom:9},action:{bindTooltip:"{JZ_NAME}"}};this.dmap.addXYLayer("基层网格乡镇街道","jsmap_jiedao_chouxi",n)},TimeFormat:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var a,n,r,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=new Date,n=a.getMonth()+1,r=a.getDate(),i=a.getFullYear(),o=i+"-"+(n>9?n:"0"+n)+"-"+r,t.t0=n,t.next=1===t.t0||2===t.t0||3===t.t0?8:11;break;case 8:return n+=9,i--,t.abrupt("break",13);case 11:return n-=3,t.abrupt("break",13);case 13:e.values=[i+"-"+(n>9?n:"0"+n)+"-01",o];case 14:case"end":return t.stop()}}),t)})))()},cleareventinfo:function(){this.eventinfourl="",this.eventinfoshow=!1},scatterData:function(){this.dmap.removeXYLayer("闪点图");var e={data:{field:"eventid,createtime,level,themeid,isurgent,isnearurgent,orguid,x,y,eventtype,",where:this.whereStr,x:"x",y:"y",size:2e5},symbol:{type:"scatter",sizeRate:2,color:{light:"rgba(92,184,92,0.4)",dark:"#fff",flash:"rgba(174,213,129,0.1)"},minZoom:1,maxZoom:1}};this.dmap.addXYLayer("闪点图","center_allevent",e)},ClusterData:function(e,t){var a=this;a.dmap.removeXYLayer("网格中心");var n={data:{field:"eventid,createtime,level,themeid,isurgent,isnearurgent,orguid,x,y,eventtype,",where:a.whereStr,x:"x",y:"y",size:5e3},symbol:{type:"Cluster",icon:new e.Icon(t,new e.Size(30,40)),bindIconField:"http://10.68.129.154:8119/pages/NSquared/static/img/{level}_{isnearurgent}.png",minZoom:2,maxZoom:7},action:{bindClick:function(e){var t=e.eventid;a.$parent.showNeventinfo(t)}}};this.dmap.addXYLayer("网格中心","center_allevent",n)},MarkerData:function(e,t){var a=this;a.dmap.removeAutoXYLayer("图标");var n={data:{field:"eventid,createtime,level,themeid,isurgent,isnearurgent,orguid,x,y,eventtype,",where:a.whereStr,x:"x",y:"y",size:500},symbol:{type:"Marker",icon:new e.Icon(t,new e.Size(30,40)),bindIconField:"http://10.68.129.154:8119/pages/NSquared/static/img/{level}_{isnearurgent}.png",minZoom:8,maxZoom:9},action:{bindClick:function(e){var t=e.eventid;a.$parent.showNeventinfo(t)}}};this.dmap.addAutoXYLayer("图标","center_allevent",n,(function(e){}))},getQuery:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var a,n,r,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a="",""!==e.themeId&&null!==e.themeId&&void 0!==e.themeId?a+="(themeid,eq,"+e.themeId+")":""!==e.type&&null!==e.type&&void 0!==e.type&&(a+="(eventtype,eq,"+e.type+")"),"001"!==e.orguid&&(a.length>0?a+="~and(orguid,like,"+e.orguid+"~)":a+="(orguid,like,"+e.orguid+"~)"),e.values.length>0&&(a.length>0?(a+="~and(createtime,gte,"+e.values[0]+" 00:00:00)",a+="~and(createtime,lte,"+e.values[1]+" 00:00:00)"):(a+="(createtime,gte,"+e.values[0]+" 00:00:00)",a+="~and(createtime,lte,"+e.values[1]+" 00:00:00)")),e.citys.length>0&&-1==e.citys.findIndex((function(e){return"all"===e}))&&(n="~and",a.length<=0&&(n=""),a+=n+"(eventtype,in,"+e.citys.join(",")+")"),"0"!==e.level1&&(r=e.level1.split("|")[0],i=e.level1.split("|")[1],o="","="==r?o="eq":"+="==r?o="gte":"+"==r?o="gt":"-="==r?o="lte":"-"==r&&(o="lt"),a.length>0?a+="~and(level,"+o+","+i+")":a+="(level,"+o+","+i+")"),a.length>0?(a+="~and(x,gt,0)",a+="~and(y,gt,0)"):(a+="(x,gt,0)",a+="~and(y,gt,0)"),e.whereStr=a;case 8:case"end":return t.stop()}}),t)})))()},getvideolist:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function a(){var n,r,s,l,m,d,c;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=t,a.next=3,i.a.fetchData_get(o.a.videomarkerlist+"?x="+e.x+"&y="+e.y,null);case 3:if("[]"!=(r=a.sent)&&null!=r&&null!=r&&""!=r){a.next=6;break}return a.abrupt("return",!1);case 6:for(s=JSON.parse(r),l=[],m=0;m<(s.length>10?10:s.length);m++)l.push({channelId:s[m].channelId,lng:s[m].gpsX,lat:s[m].gpsY,name:s[m].name});for(d=function(e){var t=l[e],a=new n.myJSMap.IconMarker({icon:"fa-camera",iconColor:"#ff0000",markerColor:"white",prefix:"fa"}),r=new n.myJSMap.Point(t.lng,t.lat),i=new n.myJSMap.Marker(r,{icon:a}),o="event_video_point"+t.channelId;n.videoIdList.push(o),i.id=o,i.data={id:o,channelId:t.channelId,name:t.name},i.bindTooltip(t.name),i.on("click",(function(e){window.parent.showvideo(t.channelId)})),n.dmap.addOverlay(i)},c=0;c<l.length;c++)d(c);case 11:case"end":return a.stop()}}),a)})))()},removeMarkerVideo:function(){var e=this;this.dmap.removeOverlayGroup("eventmarkerlist"),null!=this.videoIdList&&this.videoIdList.length>0&&this.videoIdList.forEach((function(t){e.dmap.removeOverlay(t)}))},GetEventTypeData:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e,t.next=3,i.a.fetchData_get(o.a.lh.eventtype,null);case 3:40001==(n=t.sent).type?a.eventtypeshow=!1:(a.etype=n,a.etype.data.unshift({ival:"all",iname:"全选"}),a.eventtypeshow=!0);case 5:case"end":return t.stop()}}),t)})))()},returnToIni:function(){this.level1="0",window.parent.removelevelchange(),this.citys=[],this.changeThemeEvent("","")},changeTimer:function(){this.times=this.times-1},openTimeTimer:function(){this.times=30,this.timeTimer=setInterval(this.changeTimer,1e3)},closeTimeTimer:function(){null!=this.timeTimer&&(this.times=0,clearInterval(this.timeTimer))}},watch:{citys:function(e,t){var a=e.indexOf("all"),n=t.indexOf("all");-1!=a&&-1==n&&e.length>1?this.citys=["all"]:-1!=a&&-1!=n&&e.length>1&&this.citys.splice(e.indexOf("all"),1)}}},l=(a("4063"),a("2877")),m=Object(l.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"map"}},[a("el-date-picker",{style:{zIndex:999,position:"absolute",right:"280px"},attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",disabled:!1},on:{change:function(t){return e.changeThemeEvent("","")}},model:{value:e.values,callback:function(t){e.values=t},expression:"values"}}),a("el-select",{style:{position:"absolute",right:"85px",zIndex:999,borderColor:"#f7f8fa",width:"183px"},attrs:{placeholder:"事件类型选择",multiple:"",filterable:"","allow-create":"","collapse-tags":"","value-key":"ival"},on:{change:function(t){return e.changeThemeEvent("","")}},model:{value:e.citys,callback:function(t){e.citys=t},expression:"citys"}},e._l(e.etype.data,(function(e){return a("el-option",{key:e.ival,attrs:{label:e.iname,value:e.ival}})})),1),a("el-button",{style:{zIndex:999,position:"absolute",top:"0vh",right:"0vw",fontSize:"25px"},attrs:{type:"primary",icon:"el-icon-s-home",circle:"",title:"返回初始状态"},on:{click:function(t){return e.returnToIni()}}}),a("el-button",{style:{zIndex:1001,position:"absolute",bottom:"0vh",right:"0vw",fontSize:"23px",padding:"12px"},attrs:{type:"primary",icon:"el-icon-s-fold",title:"图例",circle:""},on:{click:function(t){e.drawer=!e.drawer}}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.drawer,expression:"drawer"}],staticClass:"animated fadeInRight tl"},[e._m(0)]),a("b",{style:{position:"absolute",right:"41px",zIndex:999,color:"#000",textAlign:"center",fontSize:"17px",padding:"7px",width:"23px",backgroundColor:"#fff",borderRadius:"12px"}},[e._v(e._s(e.times))]),a("el-dialog",{attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)",title:"事件详情",visible:e.eventinfoshow,modal:!0,"modal-append-to-body":!1,width:"1366px"},on:{"update:visible":function(t){e.eventinfoshow=t}}},[a("Eventinfo",{ref:"eventinfo"})],1)],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("img",{staticClass:"imgs",attrs:{src:"http://10.68.129.154:8119/pages/NSquared/static/img/1_0.png"}}),t("div",[this._v("一级事件")])]),t("li",[t("img",{staticClass:"imgs",attrs:{src:"http://10.68.129.154:8119/pages/NSquared/static/img/2_0.png"}}),t("div",[this._v("二级事件")])]),t("li",[t("img",{staticClass:"imgs",attrs:{src:"http://10.68.129.154:8119/pages/NSquared/static/img/3_0.png"}}),t("div",[this._v("三级及以上")])]),t("li",[t("img",{staticClass:"imgs",attrs:{src:"http://10.68.129.154:8119/pages/NSquared/static/img/3_1.png"}}),t("div",[this._v("三级及以上紧急事件")])]),t("li",[t("img",{staticClass:"imgs",attrs:{src:"http://10.68.129.154:8119/pages/NSquared/static/img/3_2.png"}}),t("div",[this._v("近3天三级及以上紧急事件")])]),t("li",[t("img",{staticClass:"imgs",attrs:{src:"http://10.68.129.154:8119/pages/NSquared/static/img/new.png"}}),t("div",[this._v("今日事件")])])])}],!1,null,"50f9a4c2",null);t.default=m.exports},4063:function(e,t,a){"use strict";var n=a("f054");a.n(n).a},f054:function(e,t,a){}}]);